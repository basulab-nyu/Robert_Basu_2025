#pragma rtGlobals=1		// Use modern global access method.#include <Waves Average>macro Local_Derivative_Integral()pLocal_Derivative_Integral()proc pLocal_Derivative_Integral(str_input,str_batch)string str_inputprompt str_input "input waves ?"string str_batchprompt str_batch "batch size ?"string str_list = sortlist(wavelist(str_input,";",""),";",16)variable var_indexvariable var_index2variable var_index3var_index = 0 //looping over wavesdo	make/o/n=(dimsize($stringfromlist(var_index,str_list),0)/str2num(str_batch),dimsize($stringfromlist(var_index,str_list),1)) $(stringfromlist(var_index,str_list)+"_d")	make/o/n=(dimsize($stringfromlist(var_index,str_list),0)/str2num(str_batch),dimsize($stringfromlist(var_index,str_list),1)) $(stringfromlist(var_index,str_list)+"_i")	duplicate $stringfromlist(var_index,str_list) tempD	differentiate tempD	var_index2 = 0 //looping over cols	do		var_index3 = 0 //looping over rows		do			duplicate/o/r=[var_index3*str2num(str_batch),str2num(str_batch)-1+var_index3*str2num(str_batch)][var_index2] tempD,tempDsub			wavestats/q tempDsub			$(stringfromlist(var_index,str_list)+"_d")[var_index3][var_index2] = v_avg			duplicate/o/r=[var_index3*str2num(str_batch),str2num(str_batch)-1+var_index3*str2num(str_batch)][var_index2] $stringfromlist(var_index,str_list),tempsub			$(stringfromlist(var_index,str_list)+"_i")[var_index3][var_index2] = faverage(tempsub)			setdimlabel 0,var_index3,$getdimlabel($stringfromlist(var_index,str_list),0,var_index3*str2num(str_batch)),$(stringfromlist(var_index,str_list)+"_d")			setdimlabel 0,var_index3,$getdimlabel($stringfromlist(var_index,str_list),0,var_index3*str2num(str_batch)),$(stringfromlist(var_index,str_list)+"_i")			var_index3+=1		while(var_index3<dimsize($stringfromlist(var_index,str_list),0)/str2num(str_batch))		var_index2+=1	while(var_index2<dimsize($stringfromlist(var_index,str_list),1))	copydimlabels/rows=0/cols=1 $stringfromlist(var_index,str_list),$(stringfromlist(var_index,str_list)+"_i")	killwaves/z temp,tempD,tempsub,tempDsub	var_index+=1while(var_index<itemsinlist(str_list))end