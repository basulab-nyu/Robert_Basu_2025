#pragma rtGlobals=1		// Use modern global access method.#include <Waves Average>macro matrix_index_concatenate_x()pmatrix_index_concatenate_x()proc pmatrix_index_concatenate_x(str_input,str_sort)string str_inputprompt str_input "input waves (textref) ?"string str_sortprompt str_sort "sorting waves (textref) ?"if(strlen(str_input) == 0)	str_input = "wdata"endifif(strlen(str_sort) == 0)	str_sort = "widx"endifstring str_outputstring str_output2string str_liststring str_idxlistvariable var_refvariable var_indexvariable var_xvariable var_yvariable var_ixvariable var_incvariable var_iincvariable var_index1var_ref = 0do	str_list = ""	str_list = sortlist(wavelist($str_input[var_ref],";",""),";",16)	str_idxlist = ""	str_idxlist = sortlist(wavelist($str_sort[var_ref],";",""),";",16)	str_output = ""	str_output = $str_input[var_ref]	do		str_output = str_output[0,strsearch(str_output,"*",0)-1]+str_output[strsearch(str_output,"*",0)+1,inf]	while(grepstring(str_output,"\*") == 1)	str_output = str_output+"_conc"	str_output = replacestring("__",str_output,"_")	str_output2 = ""	str_output2 = $str_sort[var_ref]	do		str_output2 = str_output2[0,strsearch(str_output2,"*",0)-1]+str_output2[strsearch(str_output2,"*",0)+1,inf]	while(grepstring(str_output2,"\*") == 1)	str_output2 = str_output2+"_conc"	str_output2 = replacestring("__",str_output2,"_")	if(itemsinlist(str_list)>0 && itemsinlist(str_idxlist)>0)		print str_output+" found"		print replacestring(";",str_list,"\r")		print str_output2+" found"		print replacestring(";",str_idxlist,"\r")		var_x = 0		var_y = 0		var_index = 0		do			var_x = var_x+dimsize($stringfromlist(var_index,str_list),0)			var_y = max(var_y,dimsize($stringfromlist(var_index,str_list),1))			var_index+=1		while(var_index<itemsinlist(str_list))		make/o/n=(var_x,var_y) $(str_output+"_data") = nan		var_ix = 0		var_index = 0		do			var_ix = var_ix+dimsize($stringfromlist(var_index,str_idxlist),0)			var_index+=1		while(var_index<itemsinlist(str_idxlist))		make/o/n=(var_ix) $(str_output2+"_idx") = nan		var_inc = 0		var_iinc = 0		var_index = 0		do			var_index1 = 0			do				$(str_output+"_data")[var_index1+var_inc][] = $stringfromlist(var_index,str_list)[var_index1][q]								$(str_output2+"_idx")[var_index1+var_iinc] = $stringfromlist(var_index,str_idxlist)[var_index1]								if(strlen(getdimlabel($stringfromlist(var_index,str_list),0,var_index1))>0)					setdimlabel 0,var_index1+var_inc,$getdimlabel($stringfromlist(var_index,str_list),0,var_index1),$(str_output+"_data")				else					setdimlabel 0,var_index1+var_inc,$stringfromlist(var_index,str_list),$(str_output+"_data")				endif				if(strlen(getdimlabel($stringfromlist(var_index,str_idxlist),0,var_index1))>0)					setdimlabel 0,var_index1+var_iinc,$getdimlabel($stringfromlist(var_index,str_idxlist),0,var_index1),$(str_output2+"_idx")				else					setdimlabel 0,var_index1+var_iinc,$stringfromlist(var_index,str_idxlist),$(str_output2+"_idx")				endif				var_index1+=1			while(var_index1<dimsize($stringfromlist(var_index,str_list),0))			var_inc+=dimsize($stringfromlist(var_index,str_list),0)			var_iinc+=dimsize($stringfromlist(var_index,str_idxlist),0)			var_index+=1		while(var_index<itemsinlist(str_list))		copydimlabels/cols=1 $stringfromlist(0,str_list),$(str_output+"_data")	else		print str_output+" empty or "+str_output2+" empty"	endif	var_ref+=1while(var_ref<numpnts($str_input))end