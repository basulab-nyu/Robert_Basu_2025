#pragma rtGlobals=1		// Use modern global access method.#include <Waves Average>macro concatenate_matrix_dim()pconcatenate_matrix_dim()proc pconcatenate_matrix_dim(str_input,str_dim)string str_inputprompt str_input "input waves (textref) ?"string str_dimprompt str_dim "dimension ?"if(strlen(str_input) == 0)	str_input = "wref"endifif(strlen(str_dim) == 0)	str_dim = "0"endifstring str_liststring str_outputstring str_tempvariable var_indexvariable var_index1variable var_xvariable var_yvariable var_incvariable var_ref = 0do	str_list = ""	str_list = sortlist(wavelist($str_input[var_ref],";",""),";",16)	str_output = ""	str_output = $str_input[var_ref]	do		str_output = str_output[0,strsearch(str_output,"*",0)-1]+str_output[strsearch(str_output,"*",0)+1,inf]	while(grepstring(str_output,"\*") == 1)	str_output = str_output+"_conc"	str_output = replacestring("__",str_output,"_")	print str_output	if(itemsinlist(str_list)>0)		print replacestring(";",str_list,"\r")		var_x = 0		var_y = 0		var_index = 0		if(str2num(str_dim) == 0)			do				var_x = var_x+dimsize($stringfromlist(var_index,str_list),0)				var_y = max(var_y,dimsize($stringfromlist(var_index,str_list),1))				var_index+=1			while(var_index<itemsinlist(str_list))		else			do				var_x = max(var_x,dimsize($stringfromlist(var_index,str_list),0))				var_y = var_y+dimsize($stringfromlist(var_index,str_list),1)				var_index+=1			while(var_index<itemsinlist(str_list))		endif//		if(var_x == 0)//			var_x+=1//		endif//		if(var_y == 0)//			var_y+=1//		endif		make/o/n=(var_x,var_y) $str_output = nan		if(str2num(str_dim) == 0)			var_inc = 0			var_index = 0			do				var_index1 = 0				do					$str_output[var_index1+var_inc][] = $stringfromlist(var_index,str_list)[var_index1][q]					if(strlen(getdimlabel($stringfromlist(var_index,str_list),0,var_index1))>0)						setdimlabel 0,var_index1+var_inc,$getdimlabel($stringfromlist(var_index,str_list),0,var_index1),$str_output					else						setdimlabel 0,var_index1+var_inc,$stringfromlist(var_index,str_list),$str_output					endif					var_index1+=1				while(var_index1<dimsize($stringfromlist(var_index,str_list),0))				var_inc+=dimsize($stringfromlist(var_index,str_list),0)				var_index+=1			while(var_index<itemsinlist(str_list))			copydimlabels/cols=1 $stringfromlist(0,str_list),$str_output		else			var_inc = 0			var_index = 0			do				var_index1 = 0				do//					duplicate/o $stringfromlist(var_index,str_list),temp					$str_output[][var_index1+var_inc] = $stringfromlist(var_index,str_list)[p][var_index1]					if(strlen(getdimlabel($stringfromlist(var_index,str_list),1,var_index1))>0)						setdimlabel 1,var_index1+var_inc,$getdimlabel($stringfromlist(var_index,str_list),1,var_index1),$str_output					else						setdimlabel 1,var_index1+var_inc,$stringfromlist(var_index,str_list),$str_output					endif					var_index1+=1				while(var_index1<dimsize($stringfromlist(var_index,str_list),1))				var_inc+=dimsize($stringfromlist(var_index,str_list),1)				var_index+=1			while(var_index<itemsinlist(str_list))			copydimlabels/rows=0 $stringfromlist(0,str_list),$str_output		endif	else		print "empty"	endif	var_ref+=1while(var_ref<numpnts($str_input))end