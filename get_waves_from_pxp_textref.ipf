#pragma rtGlobals=1Macro get_waves_from_pxp_textref()pget_waves_from_pxp_textref()proc pget_waves_from_pxp_textref(str_path,str_ref,str_target)string str_pathprompt str_path "root path ?"string str_refprompt str_ref "reference textwave ?"string str_targetprompt str_target "target waves ?"killvariables/a/zkillstrings/a/zkillpath/a/zif(strlen(str_path) == 0)	str_path = "Z:KO:KO_Portable:data_converted:"	//\20230518_KO131\20230518_KO131_S1C1endifif(strlen(str_ref) == 0)	str_ref = "ref"endifnewpath/o/q p_path, str_pathstring/g str_dir_list = sortlist(indexeddir(p_path,-1,0),";",16)string/g str_file_list = ""string/g str_pxp_list = ""string/g str_path_list = ""print "\nlisting files..."variable/g var_timer = StartMSTimervariable/g var_index = 0do	variable/g var_index2 = 0	do		string/g str_match = $str_ref[var_index2]		if(stringmatch(stringfromlist(var_index,str_dir_list),"*"+str_match[0,2]+"*") == 1)			str_file_list = addlistitem(str_path+stringfromlist(var_index,str_dir_list),str_file_list,";",inf)			newpath/o/q p_subpath str_path+stringfromlist(var_index,str_dir_list)			string/g str_subdir_list = sortlist(indexeddir(p_subpath,-1,0),";",16)			variable/g var_index3 = 0			do				variable/g var_index4 = 0				do					string/g str_match = $str_ref[var_index4]					if(stringmatch(stringfromlist(var_index3,str_subdir_list),"*"+str_match+"*") == 1)						str_pxp_list = addlistitem(str_path+stringfromlist(var_index,str_dir_list)+":"+stringfromlist(var_index3,str_subdir_list)+":"+stringfromlist(var_index3,str_subdir_list)+".pxp",str_pxp_list,";",inf)						str_path_list = addlistitem(str_path+stringfromlist(var_index,str_dir_list)+":"+stringfromlist(var_index3,str_subdir_list)+":",str_path_list,";",inf)					endif					var_index4+=1				while(var_index4<numpnts($str_ref))				var_index3+=1			while(var_index3<itemsinlist(str_subdir_list))		endif		var_index2+=1	while(var_index2<numpnts($str_ref))	var_index+=1while(var_index<itemsinlist(str_dir_list))print replacestring(";",str_pxp_list,"\r")print "\nfiles listed!!!"print "\ntime elapsed = "+num2str(stopMSTimer(var_timer)/1000000)+"s"print "\nloading waves..."variable/g var_timer = StartMSTimervariable/g var_index = 0do	print "\nworking on "+stringfromlist(var_index,str_pxp_list)+"..."	newpath/o/q p_pxppath stringfromlist(var_index,str_path_list)	loaddata/grep={str_target,1,1,0}/l=1/p=p_pxppath/q/t/o stringfromlist(var_index,str_pxp_list)	var_index+=1while(var_index<itemsinlist(str_pxp_list))print "\nwaves loaded!!!"print "\ntime elapsed = "+num2str(stopMSTimer(var_timer)/60000000)+"min"end