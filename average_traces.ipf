#pragma rtGlobals=1Macro average_traces()paverage_traces()proc paverage_traces(str_input,str_output)string str_inputprompt str_input "input waves ?"string str_outputprompt str_output "output waves ?"string str_name = str_inputvariable var_star = 1do	if(strsearch(str_name,"*",0) == -1)		var_star = 0	else		str_name = str_name[-inf,strsearch(str_name,"*",0)-1]+str_name[strsearch(str_name,"*",0)+1,inf]	endifwhile(var_star == 1)str_name = "w_"+str_nameif(strlen(str_output) == 0)	str_output = "bs"endifstring str_list = sortlist(wavelist(str_input,";",""),";",16)string str_graph_list = sortlist(winlist("*",";","WIN:1"),";",16)string str_table_list = sortlist(winlist("*",";","WIN:2"),";",16)variable var_graph_last = itemsinlist(str_graph_list)-1string str_graph_last = winname(0,1)variable var_table_last = itemsinlist(str_table_list)-1string str_table_last = winname(0,2)getwindow $str_graph_last, wsizevariable var_left_g = v_left + 5.25variable var_top_g = v_top + 22.5variable var_right_g = v_right + 5.25variable var_bottom_g = v_bottom + 22.5getwindow $str_table_last, wsizevariable var_left_t = v_left + 5.25variable var_top_t = v_top + 22.5variable var_right_t = v_right + 5.25variable var_bottom_t = v_bottom + 22.5variable var_index = 0string str_bs_list = ""silent 1pauseupdatedisplaymovewindow var_left_g,var_top_g,var_right_g,var_bottom_gdo	duplicate/o $stringfromlist(var_index,str_list) $(stringfromlist(var_index,str_list)+"_"+str_output)	wavestats/q $(stringfromlist(var_index,str_list)+"_"+str_output)	$(stringfromlist(var_index,str_list)+"_"+str_output) = $(stringfromlist(var_index,str_list)+"_"+str_output)-v_avg	str_bs_list = addlistitem(stringfromlist(var_index,str_list)+"_"+str_output,str_bs_list)	appendtograph $(stringfromlist(var_index,str_list)+"_"+str_output)	var_index+=1while(var_index<itemsinlist(str_list))modifygraph rgb=(0,0,0)resumeupdateprint replacestring(";",str_list,"\r")fWaveAverage(str_bs_list,"",3,0,str_name+"_avg",str_name+"_sem")appendtograph $(str_name+"_avg")modifygraph rgb($(str_name+"_avg")) = (65535,0,0)errorbars $(str_name+"_avg"),SHADE={0,0,(65535,0,0,32768),(0,0,0,0)},wave=($(str_name+"_sem"),$(str_name+"_sem"))end