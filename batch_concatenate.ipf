#pragma rtGlobals=1#include <Waves Average>macro batch_concatenate()pbatch_concatenate()proc pbatch_concatenate(str_input)string str_inputprompt str_input "reference text array ?"string/g str_list = sortlist(wavelist("*",";",""),";",16)killwaves/z w_grepmake/o/n=(1,dimsize($str_input,1)) w_size = nanvariable/g var_cols = 0do	variable/g var_rows = 0	do		if(strlen($str_input[var_rows][var_cols])>0)			w_size[0][var_cols] = var_rows+1		endif		var_rows+=1	while(var_rows<dimsize($str_input,0))	var_cols+=1while(var_cols<dimsize($str_input,1))variable/g var_size = w_size[0][0]variable/g var_scroll = 1do	var_size = var_size*w_size[0][var_scroll]	var_scroll+=1while(var_scroll<dimsize(w_size,1))variable/g var_chunk = wavemax(w_size)variable/g var_scroll = 0do	make/o/t/n=(w_size[0][var_scroll]) w_ini = "*"	variable/g var_index = 0	do		if(w_size[0][var_scroll] == var_chunk)			duplicate/o/r=[0,w_size[0][var_scroll]-1][var_scroll] $str_input tempwave			redimension/n=-1 tempwave			tempwave = w_ini + tempwave			concatenate/np=0 {tempwave},w_grep			var_index+=var_chunk		else			duplicate/o/r=[0,w_size[0][var_scroll]-1][var_scroll] $str_input tempwave			redimension/n=-1 tempwave			tempwave = w_ini + tempwave			make/o/t/n=(var_size) fillwave			variable/g var_fill = 0			do				if(mod(w_size[0][var_scroll-1],2) != mod(w_size[0][var_scroll],2))					variable/g var_alt = 0					do						fillwave[var_alt+var_fill*var_chunk,var_alt-1+var_chunk+var_fill*var_chunk] = tempwave[var_fill]						var_alt+=var_chunk*w_size[0][var_scroll]					while(var_alt<var_size)				else					variable/g var_alt = 0					do						fillwave[var_alt+var_fill*(var_size/w_size[0][var_scroll]),var_alt-1+(var_size/w_size[0][var_scroll])+var_fill*(var_size/w_size[0][var_scroll])] = tempwave[var_fill]						var_alt+=var_size/w_size[0][var_scroll]					while(var_alt<var_size)				endif				var_fill+=1			while(var_fill<w_size[0][var_scroll])			w_grep = w_grep + fillwave				var_index=var_size		endif	while(var_index<var_size)	var_scroll+=1while(var_scroll<dimsize(w_size,1))variable/g var_index = 0do	string/g str_greplist = listmatch(str_list,w_grep[var_index])	print "\ngroup ID:" + w_grep[var_index]	print replacestring(";",str_greplist,"\r")	string/g str_tempname = w_grep[var_index]	str_tempname = replacestring("(?i)",str_tempname,"")	string/g str_name = ""	variable/g var_parse=0	do		string/g str_tempcut = str_tempname[strlen(str_name)+strlen("*")*var_parse,inf]		if(strsearch(str_tempcut,"*",0) != -1)			variable/g var_str = strsearch(str_tempcut,"*",0)-1			str_name = str_name + str_tempcut[0,var_str]		else			str_name = str_name + str_tempcut		endif		var_parse+=1	while(var_parse<dimsize(w_size,1))	str_name = str_name + (w_grep[var_index])[strsearch(w_grep[var_index],"*",inf,1)+1,inf]	str_name = replacestring("__",str_name,"_")	if(numpnts($stringfromlist(0,str_greplist)) == 1)		make/o/n=(itemsinlist(str_greplist)) $(str_name+"_concat") = nan	endif	if(numpnts($stringfromlist(0,str_greplist)) > 1)		make/o/n=(numpnts($stringfromlist(0,str_greplist)),itemsinlist(str_greplist)) $(str_name+"_concat") = nan	endif	variable/g var_scroll = 0	do		if(numpnts($stringfromlist(var_scroll,str_greplist)) == 1)			$(str_name+"_concat")[var_scroll] = $stringfromlist(var_scroll,str_greplist)			setdimlabel 0,var_scroll,$stringfromlist(var_scroll,str_greplist),$(str_name+"_concat")		endif		if(numpnts($stringfromlist(var_scroll,str_greplist)) > 1)			$(str_name+"_concat")[][var_scroll] = $stringfromlist(var_scroll,str_greplist)[p]			setdimlabel 1,var_scroll,$stringfromlist(var_scroll,str_greplist),$(str_name+"_concat")			copydimlabels/rows=0 $stringfromlist(var_scroll,str_greplist),$(str_name+"_concat")		endif		var_scroll+=1	while(var_scroll<itemsinlist(str_greplist))	var_index+=1while(var_index<numpnts(w_grep))killwaves/z w_size,tempwave,fillwave,w_ini,w_grepend