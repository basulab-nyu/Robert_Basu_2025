#pragma rtGlobals=1Macro average_subrange()paverage_subrange()proc paverage_subrange(str_input,str_start,str_end,str_ow,str_output)string str_inputprompt str_input "input waves ?"string str_startprompt str_start "start point ?"string str_endprompt str_end "end point ?"string str_owprompt str_ow "overwrite source waves ?"string str_outputprompt str_output "output waves ?"if(strlen(str_ow) == 0)	variable/g var_ow = 0else	variable/g var_ow = str2num(str_ow)endifif(strlen(str_output) == 0)	str_output = "temp"endifstring/g str_list = sortlist(wavelist(str_input,";",""),";",16)print replacestring(";",str_list,"\r")variable/g var_start = str2num(str_start)variable/g var_end = str2num(str_end)silent 1pauseupdatevariable/g var_index = 0do	duplicate/o $stringfromlist(var_index,str_list) $(stringfromlist(var_index,str_list)+"_"+str_output)	if(dimsize($stringfromlist(var_index,str_list),1) == 0)		deletepoints var_start,(var_end-var_start+1),$(stringfromlist(var_index,str_list)+"_"+str_output)		wavestats/q/r=[var_start,var_end] $stringfromlist(var_index,str_list)		insertpoints/v=(v_avg) var_start,1,$(stringfromlist(var_index,str_list)+"_"+str_output)		if(grepstring(getdimlabel($stringfromlist(var_index,str_list),0,var_start),"((?i)[0-9]{6}+[c]{1}+[0-9]{1,2})") == 1)			if(exists("str_grep") == 2)				killstrings/z str_grep			endif			string/g str_grep			splitstring/e=("((?i)[0-9]{6}+[c]{1}+[0-9]{1,2})") getdimlabel($stringfromlist(var_index,str_list),0,var_start),str_grep			setdimlabel 0,var_start,$str_grep,$(stringfromlist(var_index,str_list)+"_"+str_output)		endif	else		deletepoints var_start,(var_end-var_start+1),$(stringfromlist(var_index,str_list)+"_"+str_output)		insertpoints/v=(nan) var_start,1,$(stringfromlist(var_index,str_list)+"_"+str_output)		variable/g var_sub = 0		do			wavestats/q/rmd=[var_start,var_end][var_sub] $stringfromlist(var_index,str_list)			$(stringfromlist(var_index,str_list)+"_"+str_output)[var_start][var_sub] = v_avg			var_sub+=1		while(var_sub<dimsize($stringfromlist(var_index,str_list),1))		if(grepstring(getdimlabel($stringfromlist(var_index,str_list),0,var_start),"((?i)[0-9]{6}+[c]{1}+[0-9]{1,2})") == 1)			if(exists("str_grep") == 2)				killstrings/z str_grep			endif			string/g str_grep			splitstring/e=("((?i)[0-9]{6}+[c]{1}+[0-9]{1,2})") getdimlabel($stringfromlist(var_index,str_list),0,var_start),str_grep			setdimlabel 0,var_start,$str_grep,$(stringfromlist(var_index,str_list)+"_"+str_output)		endif	endif	if(var_ow == 1)		deletepoints var_start,(var_end-var_start+1),$stringfromlist(var_index,str_list)		insertpoints/v=(nan) var_start,1,$stringfromlist(var_index,str_list)		$stringfromlist(var_index,str_list) = $(stringfromlist(var_index,str_list)+"_"+str_output)		setdimlabel 0,var_start,$str_grep,$stringfromlist(var_index,str_list)		killwaves/z $(stringfromlist(var_index,str_list)+"_"+str_output)	endif	var_index+=1while(var_index<itemsinlist(str_list))resumeupdateend