#pragma rtGlobals=1macro matrix_select_row_avg()pmatrix_select_row_avg()proc pmatrix_select_row_avg(str_input,str_vecidx,str_output)string str_inputprompt str_input "input waves ?"string str_vecidxprompt str_vecidx "index vector ?"string str_outputprompt str_output "output waves ?"if(strlen(str_vecidx) == 0)	str_vecidx = "wlookup"endifif(strlen(str_output) == 0)	str_output = "c"endifstring str_list = sortlist(wavelist(str_input,";",""),";",16)print replacestring(";",str_list,"\r")string str_avglistvariable var_indexvariable var_index1variable var_index2variable var_killvar_index = 0do	make/o/n=(0,dimsize($stringfromlist(var_index,str_list),1)) $(stringfromlist(var_index,str_list)+"_"+str_output)	var_kill = 0	var_index1 = 0	do		if($str_vecidx[var_index1] == 0)			redimension/n=(dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),0)+1,dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),1)) $(stringfromlist(var_index,str_list)+"_"+str_output)			$(stringfromlist(var_index,str_list)+"_"+str_output)[dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),0)-1][] = $stringfromlist(var_index,str_list)[var_index1][q]			setdimlabel 0,dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),0)-1,$getdimlabel($stringfromlist(var_index,str_list),0,var_index1),$(stringfromlist(var_index,str_list)+"_"+str_output)		else			var_index2 = var_index1			do				if($str_vecidx[var_index2] == 1)					duplicate/o/r=[var_index2][] $stringfromlist(var_index,str_list),$("temprow_"+num2str(var_index2))					matrixtranspose $("temprow_"+num2str(var_index2))					redimension/n=-1 $("temprow_"+num2str(var_index2))					str_avglist = addlistitem("temprow_"+num2str(var_index2),str_avglist,";",inf)				endif				var_index2+=1			while(var_index2<dimsize($str_vecidx,0))			if(var_kill == 0)				fwaveaverage(str_avglist,"",0,0,"temprow_avg","")				matrixtranspose $("temprow_avg")				redimension/n=(dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),0)+1,dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),1)) $(stringfromlist(var_index,str_list)+"_"+str_output)				$(stringfromlist(var_index,str_list)+"_"+str_output)[dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),0)-1][] = $("temprow_avg")[var_index1][q]				setdimlabel 0,dimsize($(stringfromlist(var_index,str_list)+"_"+str_output),0)-1,$("avg"),$(stringfromlist(var_index,str_list)+"_"+str_output)				var_kill = 1			endif		endif		var_index1+=1	while(var_index1<dimsize($str_vecidx,0))	var_index1 = 0	do		killwaves/z $stringfromlist(var_index1,str_avglist)		var_index1+=1	while(var_index1<itemsinlist(str_avglist))	killwaves/z $("temprow_avg")	var_index+=1while(var_index<itemsinlist(str_list))end