#pragma rtGlobals=1#include <Waves Average>macro batch_avg_sem_sd()pbatch_avg_sem_sd()proc pbatch_avg_sem_sd(str_input)string str_inputprompt str_input "reference text array ?"string/g str_list = sortlist(wavelist("*",";",""),";",16)killwaves/z w_grepmake/o/n=(1,dimsize($str_input,1)) w_size = nanvariable/g var_cols = 0do	variable/g var_rows = 0	do		if(strlen($str_input[var_rows][var_cols])>0)			w_size[0][var_cols] = var_rows+1		endif		var_rows+=1	while(var_rows<dimsize($str_input,0))	var_cols+=1while(var_cols<dimsize($str_input,1))variable/g var_size = w_size[0][0]variable/g var_scroll = 1do	var_size = var_size*w_size[0][var_scroll]	var_scroll+=1while(var_scroll<dimsize(w_size,1))variable/g var_chunk = wavemax(w_size)variable/g var_scroll = 0do	if(var_scroll == 0)		make/o/t/n=(w_size[0][var_scroll]) w_ini = "(?i)"	else		make/o/t/n=(w_size[0][var_scroll]) w_ini = ".*"	endif	variable/g var_index = 0	do		if(w_size[0][var_scroll] == var_chunk)			duplicate/o/r=[0,w_size[0][var_scroll]-1][var_scroll] $str_input tempwave			redimension/n=-1 tempwave			tempwave = w_ini + tempwave			concatenate/np=0 {tempwave},w_grep			var_index+=var_chunk		else			duplicate/o/r=[0,w_size[0][var_scroll]-1][var_scroll] $str_input tempwave			redimension/n=-1 tempwave			tempwave = w_ini + tempwave			make/o/t/n=(var_size) fillwave			variable/g var_fill = 0			do				if(mod(w_size[0][var_scroll-1],2) != mod(w_size[0][var_scroll],2))					variable/g var_alt = 0					do						fillwave[var_alt+var_fill*var_chunk,var_alt-1+var_chunk+var_fill*var_chunk] = tempwave[var_fill]						var_alt+=var_chunk*w_size[0][var_scroll]					while(var_alt<var_size)				else					variable/g var_alt = 0					do						fillwave[var_alt+var_fill*(var_size/w_size[0][var_scroll]),var_alt-1+(var_size/w_size[0][var_scroll])+var_fill*(var_size/w_size[0][var_scroll])] = tempwave[var_fill]						var_alt+=var_size/w_size[0][var_scroll]					while(var_alt<var_size)				endif				var_fill+=1			while(var_fill<w_size[0][var_scroll])			w_grep = w_grep + fillwave				var_index=var_size		endif	while(var_index<var_size)	var_scroll+=1while(var_scroll<dimsize(w_size,1))variable/g var_index = 0do	string/g str_greplist = greplist(str_list,w_grep[var_index])	print "\ngroup ID:" + w_grep[var_index]	print replacestring(";",str_greplist,"\r")	string/g str_reg = "((?i)[0-9]{6}+[c]{1}+[0-9]{1})"	string/g str_reg2 = "((?i)[0-9]{6}+[c]{1}+[0-9]{2})"	if(grepstring(stringfromlist(0,str_greplist),str_reg) == 1 || grepstring(stringfromlist(0,str_greplist),str_reg2) == 1)		string/g str_catch		if(grepstring(stringfromlist(0,str_greplist),str_reg2) == 1)			splitstring/e=str_reg2 stringfromlist(0,str_greplist),str_catch			variable/g var_split = strsearch(stringfromlist(0,str_greplist),str_catch,0)			string/g str_name = stringfromlist(0,str_greplist)[0,var_split-1]+stringfromlist(0,str_greplist)[var_split+strlen(str_catch),inf]		else			splitstring/e=str_reg stringfromlist(0,str_greplist),str_catch			variable/g var_split = strsearch(stringfromlist(0,str_greplist),str_catch,0)			string/g str_name = stringfromlist(0,str_greplist)[0,var_split-1]+stringfromlist(0,str_greplist)[var_split+strlen(str_catch),inf]		endif	else		string/g str_tempname = w_grep[var_index]		str_tempname = replacestring("(?i)",str_tempname,"")		string/g str_name = ""		variable/g var_parse=0		do			if(var_parse == 0)				if(strsearch(str_tempcut,".*",0) != -1)					variable/g var_str = strsearch(str_tempname,".*",0)-1					str_name = str_name + str_tempname[0,var_str]				else					str_name = str_name + str_tempname				endif			else				string/g str_tempcut = str_tempname[strlen(str_name)+strlen(".*")*var_parse,inf]				if(strsearch(str_tempcut,".*",0) != -1)					variable/g var_str = strsearch(str_tempcut,".*",0)-1					str_name = str_name + str_tempcut[0,var_str]				else					str_name = str_name + str_tempcut				endif			endif			var_parse+=1		while(var_parse<dimsize(w_size,1))	endif	str_name = replacestring("__",str_name,"_")	make/o/n=(itemsinlist(str_greplist)) $(str_name+"_avg_pop") = nan	make/o/n=(itemsinlist(str_greplist)) $(str_name+"_sem_pop") = nan	make/o/n=(itemsinlist(str_greplist)) $(str_name+"_sd_pop") = nan	variable/g var_scroll = 0	do		wavestats/q $stringfromlist(var_scroll,str_greplist)		$(str_name+"_avg_pop")[var_scroll] = v_avg		$(str_name+"_sem_pop")[var_scroll] = v_sem		$(str_name+"_sd_pop")[var_scroll] = v_sdev		setdimlabel 0,var_scroll,$stringfromlist(var_scroll,str_greplist),$(str_name+"_avg_pop")		setdimlabel 0,var_scroll,$stringfromlist(var_scroll,str_greplist),$(str_name+"_sem_pop")		setdimlabel 0,var_scroll,$stringfromlist(var_scroll,str_greplist),$(str_name+"_sd_pop")		var_scroll+=1	while(var_scroll<itemsinlist(str_greplist))	var_index+=1while(var_index<numpnts(w_grep))killwaves/z w_size,tempwave,fillwave,w_ini,w_grepend