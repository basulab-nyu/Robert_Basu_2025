#pragma rtGlobals=1Macro dVdT_analysis()pdvdtA()proc pdvdtA(str_input,str_start,str_stop,str_thr,str_max,str_ahp)string str_inputprompt str_input "input waves ?"string str_startprompt str_start "start x (ms) ?"string str_stopprompt str_stop "end x (ms) ?"string str_thrprompt str_thr "threshold detection (mV/s) ?"string str_maxprompt str_max "spike max detection (mV/s) ?"string str_ahpprompt str_ahp "AHP detection (mV/s) ?"string str_list = wavelist(str_input,";","")//string str_list_sort = sortlist (str_list,";",16)string str_list_print = wavelist(str_input,"\r","")//string str_list_sort_print = sortlist (str_list_print,"\r",16)print str_list_printvariable/g var_total = itemsinlist(str_list)variable/g var_index = 0variable/g var_start = str2num(str_start)variable/g var_stop = str2num(str_stop)variable/g var_thr = str2num(str_thr)variable/g var_max = str2num(str_max)variable/g var_ahp = str2num(str_ahp)dosilent 1pauseupdate	string/g inWave = stringfromlist(var_index,str_list)	if (strlen(inWave) == 0)		break	endif	if (var_index == 0)		duplicate/r=(var_start,var_stop) $inWave, $(nameofwave($inWave)+"_T")		duplicate/r=(var_start,var_stop) $inWave, Xwave		Xwave = x		duplicate/r=(var_start,var_stop) $inWave, $(nameofwave($inWave)+"_D")		differentiate $(nameofwave($inWave)+"_D")		display $(nameofwave($inWave)+"_D") vs $(nameofwave($inWave)+"_T")		modifygraph zColor($(nameofwave($inWave)+"_D"))={Xwave,*,*,Rainbow,1}		findlevels/q/edge=1 $(nameofwave($inWave)+"_D") var_thr		wavestats/q w_findlevels		duplicate/o w_findlevels $(nameofwave($inWave)+"_thrX")		findlevels/q/edge=2 $(nameofwave($inWave)+"_D") var_max		duplicate/o w_findlevels $(nameofwave($inWave)+"_maxX")		findlevels/q/edge=1 $(nameofwave($inWave)+"_D") var_ahp		duplicate/o w_findlevels $(nameofwave($inWave)+"_ahpX")		variable/g var_N = V_npnts		make/o/n=(var_N) $(nameofwave($inWave)+"_thr")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_max")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_ahp")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_thrD")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_maxD")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_ahpD")=nan		variable/g var_count = 0		do			if (var_count == 0)			variable/g var_thrX = $(nameofwave($inWave)+"_thrX")[var_count]			$(nameofwave($inWave)+"_thr")[var_count] = $(nameofwave($inWave)+"_T")(var_thrX)			$(nameofwave($inWave)+"_thrD")[var_count] = $(nameofwave($inWave)+"_D")(var_thrX)						variable/g var_maxX = $(nameofwave($inWave)+"_maxX")[var_count]			$(nameofwave($inWave)+"_max")[var_count] = $(nameofwave($inWave)+"_T")(var_maxX)			$(nameofwave($inWave)+"_maxD")[var_count] = $(nameofwave($inWave)+"_D")(var_maxX)						variable/g var_ahpX = $(nameofwave($inWave)+"_ahpX")[var_count]			$(nameofwave($inWave)+"_ahp")[var_count] = $(nameofwave($inWave)+"_T")(var_ahpX)			$(nameofwave($inWave)+"_ahpD")[var_count] = $(nameofwave($inWave)+"_D")(var_ahpX)			else			variable/g var_thrX = $(nameofwave($inWave)+"_thrX")[var_count]			$(nameofwave($inWave)+"_thr")[var_count] = $(nameofwave($inWave)+"_T")(var_thrX)			$(nameofwave($inWave)+"_thrD")[var_count] = $(nameofwave($inWave)+"_D")(var_thrX)						variable/g var_maxX = $(nameofwave($inWave)+"_maxX")[var_count]			$(nameofwave($inWave)+"_max")[var_count] = $(nameofwave($inWave)+"_T")(var_maxX)			$(nameofwave($inWave)+"_maxD")[var_count] = $(nameofwave($inWave)+"_D")(var_maxX)						variable/g var_ahpX = $(nameofwave($inWave)+"_ahpX")[var_count]			$(nameofwave($inWave)+"_ahp")[var_count] = $(nameofwave($inWave)+"_T")(var_ahpX)			$(nameofwave($inWave)+"_ahpD")[var_count] = $(nameofwave($inWave)+"_D")(var_ahpX)			endif		var_count = var_count + 1		while (var_count <= var_N)		appendtograph $(nameofwave($inWave)+"_thrD") vs $(nameofwave($inWave)+"_thr")		modifygraph mode($(nameofwave($inWave)+"_thrD")) = 3		modifygraph rgb($(nameofwave($inWave)+"_thrD")) = (0,0,0)		appendtograph $(nameofwave($inWave)+"_maxD") vs $(nameofwave($inWave)+"_max")		modifygraph mode($(nameofwave($inWave)+"_maxD")) = 3		modifygraph rgb($(nameofwave($inWave)+"_maxD")) = (0,0,0)		appendtograph $(nameofwave($inWave)+"_ahpD") vs $(nameofwave($inWave)+"_ahp")		modifygraph mode($(nameofwave($inWave)+"_ahpD")) = 3		modifygraph rgb($(nameofwave($inWave)+"_ahpD")) = (0,0,0)	else		duplicate/r=(var_start,var_stop) $inWave, $(nameofwave($inWave)+"_T")		duplicate/r=(var_start,var_stop) $inWave, $(nameofwave($inWave)+"_D")		differentiate $(nameofwave($inWave)+"_D")		display $(nameofwave($inWave)+"_D") vs $(nameofwave($inWave)+"_T")		modifygraph zColor($(nameofwave($inWave)+"_D"))={Xwave,*,*,Rainbow,1}		findlevels/q/edge=1 $(nameofwave($inWave)+"_D") var_thr		wavestats/q w_findlevels		duplicate/o w_findlevels $(nameofwave($inWave)+"_thrX")		findlevels/q/edge=2 $(nameofwave($inWave)+"_D") var_max		duplicate/o w_findlevels $(nameofwave($inWave)+"_maxX")		findlevels/q/edge=1 $(nameofwave($inWave)+"_D") var_ahp		duplicate/o w_findlevels $(nameofwave($inWave)+"_ahpX")		variable/g var_N = V_npnts		make/o/n=(var_N) $(nameofwave($inWave)+"_thr")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_max")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_ahp")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_thrD")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_maxD")=nan		make/o/n=(var_N) $(nameofwave($inWave)+"_ahpD")=nan		variable/g var_count = 0		do			if (var_count == 0)			variable/g var_thrX = $(nameofwave($inWave)+"_thrX")[var_count]			$(nameofwave($inWave)+"_thr")[var_count] = $(nameofwave($inWave)+"_T")(var_thrX)			$(nameofwave($inWave)+"_thrD")[var_count] = $(nameofwave($inWave)+"_D")(var_thrX)						variable/g var_maxX = $(nameofwave($inWave)+"_maxX")[var_count]			$(nameofwave($inWave)+"_max")[var_count] = $(nameofwave($inWave)+"_T")(var_maxX)			$(nameofwave($inWave)+"_maxD")[var_count] = $(nameofwave($inWave)+"_D")(var_maxX)						variable/g var_ahpX = $(nameofwave($inWave)+"_ahpX")[var_count]			$(nameofwave($inWave)+"_ahp")[var_count] = $(nameofwave($inWave)+"_T")(var_ahpX)			$(nameofwave($inWave)+"_ahpD")[var_count] = $(nameofwave($inWave)+"_D")(var_ahpX)			else			variable/g var_thrX = $(nameofwave($inWave)+"_thrX")[var_count]			$(nameofwave($inWave)+"_thr")[var_count] = $(nameofwave($inWave)+"_T")(var_thrX)			$(nameofwave($inWave)+"_thrD")[var_count] = $(nameofwave($inWave)+"_D")(var_thrX)						variable/g var_maxX = $(nameofwave($inWave)+"_maxX")[var_count]			$(nameofwave($inWave)+"_max")[var_count] = $(nameofwave($inWave)+"_T")(var_maxX)			$(nameofwave($inWave)+"_maxD")[var_count] = $(nameofwave($inWave)+"_D")(var_maxX)						variable/g var_ahpX = $(nameofwave($inWave)+"_ahpX")[var_count]			$(nameofwave($inWave)+"_ahp")[var_count] = $(nameofwave($inWave)+"_T")(var_ahpX)			$(nameofwave($inWave)+"_ahpD")[var_count] = $(nameofwave($inWave)+"_D")(var_ahpX)			endif		var_count = var_count + 1		while (var_count <= var_N)		appendtograph $(nameofwave($inWave)+"_thrD") vs $(nameofwave($inWave)+"_thr")		modifygraph mode($(nameofwave($inWave)+"_thrD")) = 3		modifygraph rgb($(nameofwave($inWave)+"_thrD")) = (0,0,0)		appendtograph $(nameofwave($inWave)+"_maxD") vs $(nameofwave($inWave)+"_max")		modifygraph mode($(nameofwave($inWave)+"_maxD")) = 3		modifygraph rgb($(nameofwave($inWave)+"_maxD")) = (0,0,0)		appendtograph $(nameofwave($inWave)+"_ahpD") vs $(nameofwave($inWave)+"_ahp")		modifygraph mode($(nameofwave($inWave)+"_ahpD")) = 3		modifygraph rgb($(nameofwave($inWave)+"_ahpD")) = (0,0,0)	endifvar_index = var_index + 1while (var_index<=var_total)resumeupdate	end