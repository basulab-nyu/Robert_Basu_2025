#pragma rtGlobals=1Macro Bin_Wave_from_Ref()pBin_Wave_from_Ref()proc pBin_Wave_from_Ref(str_input,str_ref,str_1stbin,str_bin_size,str_bin_nb,str_output)string str_inputprompt str_input "input waves ?"string str_refprompt str_ref "reference waves ?"string str_1stbinprompt str_1stbin "starting bin ?"string str_bin_sizeprompt str_bin_size "bin size ?"string str_bin_nbprompt str_bin_nb "number of bins ?"string str_outputprompt str_output "output waves ?"string str_list_input = wavelist(str_input,";","")string str_list_ref = wavelist(str_ref,";","")string str_list_sort_input = sortlist (str_list_input)string str_list_sort_ref = sortlist (str_list_ref)string str_list_sort_input_print = wavelist(str_input,"\r","")string  str_list_sort_input_print_2 = sortlist (str_list_sort_input_print,"\r",16)string str_list_sort_ref_print = wavelist(str_ref,"\r","")string  str_list_sort_ref_print_2 = sortlist (str_list_sort_ref_print,"\r",16)print str_list_sort_input_print_2print str_list_sort_ref_print_2variable/g var_1stbin = str2num(str_1stbin)variable/g var_bin_size = str2num(str_bin_size)variable/g var_bin_nb = str2num(str_bin_nb)variable/g var_index = 0string/g str_waves_inputstring/g str_waves_refvariable/g var_total = itemsinlist(str_list_sort_input)edit/n=nb_tableedit/n=bin_tabledisplay/n=nb_graphdisplay/n=bin_graphcolortab2wave rainbow256variable/g var_lowrange = 0*DimSize(M_colors,0)variable/g var_highrange = 1*DimSize(M_colors,0)variable/g var_delta = (var_highrange-var_lowrange)/var_totaldosilent 1	str_waves_input = stringfromlist(var_index,str_list_sort_input)	str_waves_ref = stringfromlist(var_index,str_list_sort_ref)	variable/g var_end = numpnts($str_waves_input)	make/n=(var_bin_nb) $(nameofwave($str_waves_input)+"_"+str_output) = NaN		make/o/n=(var_end,var_bin_nb) w_storage = NaN	variable/g var_bin = var_1stbin	variable/g var_count = 0	do	variable/g var_scroll = 0	do		if($str_waves_ref[var_scroll] >= var_bin && $str_waves_ref[var_scroll] < var_bin + var_bin_size)		w_storage[var_scroll][var_count] = $str_waves_input[var_scroll]		endif	var_scroll += 1	while(var_scroll < var_end)	make/o/n=(var_end) tempwave = w_storage[p][var_count]	wavestats/q tempwave	$(nameofwave($str_waves_input)+"_"+str_output)[var_count] = v_avg	var_count += 1	var_bin = var_bin + var_bin_size	while(var_bin <= (var_bin_nb*var_bin_size)+var_1stbin)	setscale/p x 0,var_bin_size,"", $(nameofwave($str_waves_input)+"_"+str_output)	if (var_index == 0)		appendtotable/w=nb_table $str_waves_input.id		appendtograph/w=nb_graph $str_waves_input		appendtotable/w=bin_table $(nameofwave($str_waves_input)+"_"+str_output).id		appendtograph/w=bin_graph $(nameofwave($str_waves_input)+"_"+str_output)		modifygraph/w=nb_graph rgb($str_waves_input)=(m_colors[var_index*var_delta][0],m_colors[var_index*var_delta][1],m_colors[var_index*var_delta][2])		modifygraph/w=bin_graph rgb($(nameofwave($str_waves_input)+"_"+str_output))=(m_colors[var_index*var_delta][0],m_colors[var_index*var_delta][1],m_colors[var_index*var_delta][2])	else		appendtotable/w=nb_table $str_waves_input		appendtograph/w=nb_graph $str_waves_input		appendtotable/w=bin_table $(nameofwave($str_waves_input)+"_"+str_output)		appendtograph/w=bin_graph $(nameofwave($str_waves_input)+"_"+str_output)		modifygraph/w=nb_graph rgb($str_waves_input)=(m_colors[var_index*var_delta][0],m_colors[var_index*var_delta][1],m_colors[var_index*var_delta][2])		modifygraph/w=bin_graph rgb($(nameofwave($str_waves_input)+"_"+str_output))=(m_colors[var_index*var_delta][0],m_colors[var_index*var_delta][1],m_colors[var_index*var_delta][2])	endifvar_index += 1while(var_index < var_total)modifygraph/w=nb_graph mode=3, mrkThick=1.5modifygraph/w=bin_graph mode=3, mrkThick=1.5killwaves m_colorsbeepend