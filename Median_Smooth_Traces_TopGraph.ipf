#pragma rtGlobals=1Macro Median_Smooth_Traces_TopGraph()pMedian_Smooth_Traces_TopGraph()proc pMedian_Smooth_Traces_TopGraph(str_dev,str_width,str_numpls,str_plsfrq,str_numepo,str_epodelta,str_output)string str_devprompt str_dev "deviation from median (fulltrace [eg 0.5] / acute [NaN]) ?"string str_widthprompt str_width "window width (fulltrace [eg 10] / acute [NaN]) ?"string str_numplsprompt str_numpls "multiple stims (pulses [number] / fulltrace [NaN]) ?"string str_plsfrqprompt str_plsfrq "stim frequency (multi pulse [hz] / single pulse [NaN]) ?"string str_numepoprompt str_numepo "multiple trains (epochs [number] / fulltrace [NaN]) ?"string str_epodeltaprompt str_epodelta "epoch spacing (delta time [s] / fulltrace [NaN]) ?"string str_outputprompt str_output "output waves ?"string str_list = sortlist(tracenamelist("",";",1),";",16)print replacestring(";",str_list,"\r")variable/g var_dev = str2num(str_dev)variable/g var_width = str2num(str_width)variable/g var_numpls = str2num(str_numpls)variable/g var_plsfrq = 1000/str2num(str_plsfrq)variable/g var_numepo = str2num(str_numepo)variable/g var_epodelta = str2num(str_epodelta)*1000getaxis/q bottomvariable/g var_left = v_minvariable/g var_right = v_maxgetaxis/q leftvariable/g var_bottom = v_minvariable/g var_top = v_maxstring/g str_graph_list = sortlist(winlist("*",";","WIN:1"),";",16)string/g str_table_list = sortlist(winlist("*",";","WIN:2"),";",16)variable/g var_graph_last = itemsinlist(str_graph_list)-1string/g str_graph_last = winname(0,1)variable/g var_table_last = itemsinlist(str_table_list)-1string/g str_table_last = winname(0,2)getwindow $str_graph_last, wsizevariable/g var_left_g = v_left + 5.25variable/g var_top_g = v_top + 22.5variable/g var_right_g = v_right + 5.25variable/g var_bottom_g = v_bottom + 22.5getwindow $str_table_last, wsizevariable/g var_left_t = v_left + 5.25variable/g var_top_t = v_top + 22.5variable/g var_right_t = v_right + 5.25variable/g var_bottom_t = v_bottom + 22.5string/g str_replotpauseupdatesilent 1variable/g var_index = 0do	duplicate/o $stringfromlist(var_index,str_list) $(stringfromlist(var_index,str_list)+"_"+str_output)	if(strlen(csrinfo(a)) == 0 || strlen(csrinfo(b)) == 0)		smooth/m=(var_dev)/r=(nan) var_width,$(stringfromlist(var_index,str_list)+"_"+str_output)	else		make/o/n=2 sortwave = nan		sortwave[0] = xcsr(a)		sortwave[1] = xcsr(b)		sort sortwave, sortwave		variable/g var_Escroll = 0		do			variable/g var_Pscroll = 0			do				$(stringfromlist(var_index,str_list)+"_"+str_output)(sortwave[0]+var_Pscroll*var_plsfrq+var_Escroll*var_epodelta,sortwave[1]+var_Pscroll*var_plsfrq+var_Escroll*var_epodelta) = nan				var_Pscroll+=1			while(var_Pscroll<var_numpls)			var_Escroll+=1		while(var_Escroll<var_numepo)	endif	if(var_index == 0)		str_replot = stringfromlist(var_index,str_list)+"_"+str_output	else		str_replot = str_replot+";"+stringfromlist(var_index,str_list)+"_"+str_output	endif	var_index += 1while(var_index<itemsinlist(str_list))displayvariable/g var_index = 0do	appendtograph $stringfromlist(var_index,str_replot)	var_index+=1while(var_index<itemsinlist(str_replot))movewindow var_left_g,var_top_g,var_right_g,var_bottom_gsetaxis left var_bottom, var_topsetaxis bottom var_left,var_rightmodifygraph rgb=(0,0,0)showinfoshowtools/aresumeupdateend