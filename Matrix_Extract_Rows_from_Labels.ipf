#pragma rtGlobals=1		// Use modern global access method.#include <Waves Average>macro Matrix_Extract_Rows_from_Labels()pMatrix_Extract_Rows_from_Labels()proc pMatrix_Extract_Rows_from_Labels(str_input,str_lbl,str_output)string str_inputprompt str_input "input waves (textref) ?"string str_lblprompt str_lbl "label wave (textref) ?"string str_outputprompt str_output "output waves ?"string str_listvariable var_indexvariable var_index2variable var_index3variable var_index4var_index = 0do //looping over ref	str_list = sortlist(wavelist($str_input[var_index],";",""),";",16)	print replacestring(";",str_list,"\r")	var_index2 = 0	do //looping over waves		make/o/n=(numpnts($str_lbl),dimsize($stringfromlist(var_index2,str_list),1)) $(stringfromlist(var_index2,str_list)+"_"+str_output) = nan		var_index3 = 0		do //looping over labels			var_index4 = 0			do //looping over data				if(stringmatch(getdimlabel($stringfromlist(var_index2,str_list),0,var_index4),$str_lbl[var_index3]) == 1)					$(stringfromlist(var_index2,str_list)+"_"+str_output)[var_index3][] = $stringfromlist(var_index2,str_list)[var_index4][q]				endif				var_index4+=1			while(var_index4<dimsize($stringfromlist(var_index2,str_list),0))			setdimlabel 0,var_index3,$($str_lbl[var_index3]),$(stringfromlist(var_index2,str_list)+"_"+str_output)			var_index3+=1		while(var_index3<numpnts($str_lbl))		var_index2+=1	while(var_index2<itemsinlist(str_list))	var_index+=1while(var_index<numpnts($str_input))end