#pragma rtGlobals=1Macro average_traces_top_graph()paverage_traces_top_graph()proc paverage_traces_top_graph()string str_list = TraceNameList("",";",1)string str_graph_list = sortlist(winlist("*",";","WIN:1"),";",16)string str_table_list = sortlist(winlist("*",";","WIN:2"),";",16)variable var_graph_last = itemsinlist(str_graph_list)-1string str_graph_last = winname(0,1)variable var_table_last = itemsinlist(str_table_list)-1string str_table_last = winname(0,2)getwindow $str_graph_last, wsizevariable var_left_g = v_left + 5.25variable var_top_g = v_top + 22.5variable var_right_g = v_right + 5.25variable var_bottom_g = v_bottom + 22.5getwindow $str_table_last, wsizevariable var_left_t = v_left + 5.25variable var_top_t = v_top + 22.5variable var_right_t = v_right + 5.25variable var_bottom_t = v_bottom + 22.5variable var_index = 0string str_bs_list = ""silent 1pauseupdatedisplaymovewindow var_left_g,var_top_g,var_right_g,var_bottom_gdo	duplicate/o $stringfromlist(var_index,str_list) $(stringfromlist(var_index,str_list)+"_bs")	wavestats/q $(stringfromlist(var_index,str_list)+"_bs")	$(stringfromlist(var_index,str_list)+"_bs") = $(stringfromlist(var_index,str_list)+"_bs")-v_avg	str_bs_list = addlistitem(stringfromlist(var_index,str_list)+"_bs",str_bs_list)	appendtograph $(stringfromlist(var_index,str_list)+"_bs")	var_index+=1while(var_index<itemsinlist(str_list))modifygraph rgb=(0,0,0)resumeupdateprint replacestring(";",str_list,"\r")fWaveAverage(str_bs_list,"",3,0,stringfromlist(var_index,str_list)+"_avg",stringfromlist(var_index,str_list)+"_sem")appendtograph $(stringfromlist(var_index,str_list)+"_avg")modifygraph rgb($(stringfromlist(var_index,str_list)+"_avg")) = (65535,0,0)errorbars $(stringfromlist(var_index,str_list)+"_avg"),SHADE={0,0,(65535,0,0,32768),(0,0,0,0)},wave=($(stringfromlist(var_index,str_list)+"_sem"),$(stringfromlist(var_index,str_list)+"_sem"))end