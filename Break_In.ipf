#pragma rtGlobals=1Macro Break_In()BIbF()proc BIbF(str_input,str_onset,str_length,str_pulse,str_output)string str_inputprompt str_input "input waves ?"string str_onsetprompt str_onset "pulse start (s) ?"string str_lengthprompt str_length "pulse duration (s) ?"string str_pulseprompt str_pulse "pulse amplitude (mV) ?"string str_outputprompt str_output "output waves ?"string str_list = wavelist(str_input,";","")variable/g var_onset = str2num(str_onset)*1000variable/g var_length = str2num(str_length)*1000variable/g var_pulse = str2num(str_pulse)/1000variable/g var_indexvar_index = 0string str_waves//string newnamevariable/g var_total = itemsinlist(str_list)make/o/n=(var_total) $("wRa_"+str_output)make/o/n=(var_total) $("wRm_"+str_output)make/o/n=(var_total) $("wCm_"+str_output)string/g str_graph_list = sortlist(winlist("*",";","WIN:1"),";",16)string/g str_table_list = sortlist(winlist("*",";","WIN:2"),";",16)variable/g var_graph_last = itemsinlist(str_graph_list)-1string/g str_graph_last = winname(0,1)variable/g var_table_last = itemsinlist(str_table_list)-1string/g str_table_last = winname(0,2)getwindow $str_graph_last, wsizevariable/g var_left_g = v_left + 5.25variable/g var_top_g = v_top + 22.5variable/g var_right_g = v_right + 5.25variable/g var_bottom_g = v_bottom + 22.5getwindow $str_table_last, wsizevariable/g var_left_t = v_left + 5.25variable/g var_top_t = v_top + 22.5variable/g var_right_t = v_right + 5.25variable/g var_bottom_t = v_bottom + 22.5do	silent 1pauseupdate	str_waves = stringfromlist(var_index,str_list)	if (strlen(str_waves) == 0)		break	endif	if (var_index == 0)		duplicate/o $str_waves, tempwave		display tempwave		ModifyGraph rgb(tempwave)=(0,0,0)		ShowTools		Label left "Current (pA)";DelayUpdate		Label bottom "time (ms)"		variable/g var_end_step = var_length+var_onset		wavestats/q/r=(var_onset,var_end_step) tempwave		variable/g var_start = V_minloc		CurveFit/q/M=2/W=0 dblexp_XOffset, tempwave (var_start,var_end_step)/D		variable/g tau = ((W_coef[1]* W_coef[2])+(W_coef[3]*W_coef[4]))/(W_coef[1]+W_coef[3])		wavestats/q/r=(0,var_onset) tempwave		variable/g var_base = V_avg		variable/g Io = (var_base-tempwave(var_start))/1000000000000		wavestats/q/r=((var_onset+var_length)/2,var_onset+var_length) tempwave		variable/g var_step = V_avg		variable/g Ii = (var_base-var_step)/1000000000000		variable/g Ra = var_pulse/Io		variable/g Rm = (var_pulse/Ii)-Ra		variable/g Cm = tau/(Ra+Rm)/1000000		print Ra		print Rm		print Cm		rename tempwave, $(nameofwave($str_waves)+"_"+str_output)		rename fit_tempwave, $(nameofwave($str_waves)+"_"+str_output+"_fit")		rename W_coef, $(nameofwave($str_waves)+"_"+str_output+"_coeffs")		killwaves/z $str_waves, M_Covar, W_sigma, W_fitConstants		$("wRa_"+str_output)[var_index] = Ra		setdimlabel 0,var_index,$str_waves,$("wRa_"+str_output)		$("wRm_"+str_output)[var_index] = Rm		setdimlabel 0,var_index,$str_waves,$("wRm_"+str_output)		$("wCm_"+str_output)[var_index] = Cm		setdimlabel 0,var_index,$str_waves,$("wCm_"+str_output)	else		duplicate/o $str_waves, tempwave		display tempwave		ModifyGraph rgb(tempwave)=(0,0,0)		ShowTools		Label left "Current (pA)";DelayUpdate		Label bottom "time (ms)"		variable/g var_end_step = var_length+var_onset		wavestats/q/r=(var_onset,var_end_step) tempwave		variable/g var_start = V_minloc		CurveFit/q/M=2/W=0 dblexp_XOffset, tempwave (var_start,var_end_step)/D		variable/g tau = ((W_coef[1]* W_coef[2])+(W_coef[3]*W_coef[4]))/(W_coef[1]+W_coef[3])		wavestats/q/r=(0,var_onset) tempwave		variable/g var_base = V_avg		variable/g Io = (var_base-tempwave(var_start))/1000000000000		wavestats/q/r=((var_onset+var_length)/2,var_onset+var_length) tempwave		variable/g var_step = V_avg		variable/g Ii = (var_base-var_step)/1000000000000		variable/g Ra = var_pulse/Io		variable/g Rm = (var_pulse/Ii)-Ra		variable/g Cm = tau/(Ra+Rm)/1000000		print Ra		print Rm		print Cm		rename tempwave, $(nameofwave($str_waves)+"_"+str_output)		rename fit_tempwave, $(nameofwave($str_waves)+"_"+str_output+"_fit")		rename W_coef, $(nameofwave($str_waves)+"_"+str_output+"_coeffs")		killwaves/z $str_waves, M_Covar, W_sigma, W_fitConstants		$("wRa_"+str_output)[var_index] = Ra		setdimlabel 0,var_index,$str_waves,$("wRa_"+str_output)		$("wRm_"+str_output)[var_index] = Rm		setdimlabel 0,var_index,$str_waves,$("wRm_"+str_output)		$("wCm_"+str_output)[var_index] = Cm		setdimlabel 0,var_index,$str_waves,$("wCm_"+str_output)	endif	var_index += 1while(1)resumeupdatemovewindow var_left_g,var_top_g,var_right_g,var_bottom_gedit.ld $("wRa_"+str_output),$("wRm_"+str_output),$("wCm_"+str_output)movewindow var_left_t,var_top_t,var_right_t,var_bottom_tDrawText 0.332493702770781,0.175355450236967,"Ra =  MOhm"DrawText 0.319899244332494,0.265402843601896,"Rm =  MOhm"DrawText 0.319899244332494,0.341232227488152,"Cm =  pF"end