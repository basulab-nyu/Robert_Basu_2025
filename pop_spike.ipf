#pragma rtGlobals=1Macro pop_spike()ppop_spike()proc ppop_spike(str_base_w,str_peak_w,str_output)//string str_stim//prompt str_stim "stim onset (ms) ?"string str_base_wprompt str_base_w "baseline window (ms) ?"string str_peak_wprompt str_peak_w "peak window (ms) ?"string str_outputprompt str_output "output waves ?"string/g str_graph_list = sortlist(winlist("*",";","WIN:1"),";",16)string/g str_table_list = sortlist(winlist("*",";","WIN:2"),";",16)variable/g var_graph_last = itemsinlist(str_graph_list)-1string/g str_graph_last = winname(0,1)variable/g var_table_last = itemsinlist(str_table_list)-1string/g str_table_last = winname(0,2)getwindow $str_graph_last, wsizevariable/g var_left_g = v_left + 5.25variable/g var_top_g = v_top + 22.5variable/g var_right_g = v_right + 5.25variable/g var_bottom_g = v_bottom + 22.5getwindow $str_table_last, wsizevariable/g var_left_t = v_left + 5.25variable/g var_top_t = v_top + 22.5variable/g var_right_t = v_right + 5.25variable/g var_bottom_t = v_bottom + 22.5silent 1pauseupdatecheckdisplayed w_baseif (v_flag == 1)removefromgraph w_baseremovefromgraph w_baseendifcheckdisplayed w_peak1if (v_flag == 1)removefromgraph w_peak1removefromgraph w_peak1endifcheckdisplayed w_peak2if (v_flag == 1)removefromgraph w_peak2removefromgraph w_peak2endifcheckdisplayed w_peak3if (v_flag == 1)removefromgraph w_peak3removefromgraph w_peak3endifcheckdisplayed w_onsetif (v_flag == 1)removefromgraph w_onsetendifcheckdisplayed w_lagif (v_flag == 1)removefromgraph w_lagendifcheckdisplayed w_rise_1090if (v_flag == 1)removefromgraph w_rise_1090removefromgraph w_rise_1090endifcheckdisplayed w_rise_2080if (v_flag == 1)removefromgraph w_rise_2080removefromgraph w_rise_2080endifcheckdisplayed w_decay_1090if (v_flag == 1)removefromgraph w_decay_1090removefromgraph w_decay_1090endifcheckdisplayed w_decay_2080if (v_flag == 1)removefromgraph w_decay_2080removefromgraph w_decay_2080endifcheckdisplayed w_fwhmif (v_flag == 1)removefromgraph w_fwhmremovefromgraph w_fwhmendifstring str_list = tracenamelist("",";",1)string str_list_sort = sortlist (str_list,";",16)string str_list_sort_input_print = tracenamelist("","\r",1)string str_list_sort_input_print_2 = sortlist (str_list_sort_input_print,"\r",16)print str_list_sort_input_print_2//variable/g var_stim = str2num(str_stim)make/o/n=3 sortwave = NaNsortwave[0] = xcsr(A)sortwave[1] = xcsr(B)sortwave[2] = xcsr(C)sort sortwave, sortwavevariable/g var_stim = sortwave[0]variable/g var_bs = sortwave[1]variable/g var_end = sortwave[2]killwaves sortwavevariable/g var_base_w = str2num(str_base_w)variable/g var_peak_w = str2num(str_peak_w)variable/g var_index = 0string str_wavesvariable/g var_total = itemsinlist(str_list_sort)make/o/n=(var_total,4) w_base = NaNmake/o/n=(var_total,4) w_peak1 = NaNmake/o/n=(var_total,4) w_peak2 = NaNmake/o/n=(var_total,4) w_peak3 = NaNmake/o/n=(var_total,2) w_onset = NaNmake/o/n=(var_total,2) w_lag = NaN//make/o/n=(var_total) w_rise = NaNmake/o/n=(var_total,4) w_rise_1090 = NaNmake/o/n=(var_total,4) w_rise_2080 = NaN//make/o/n=(var_total) w_decay = NaNmake/o/n=(var_total,4) w_decay_1090 = NaNmake/o/n=(var_total,4) w_decay_2080 = NaNmake/o/n=(var_total,4) w_fwhm = NaN//make/o/t/n=(var_total)/o w_namesmake/o/n=(var_total) $("bs_"+str_output) = NaNmake/o/n=(var_total) $("amp_"+str_output) = NaNmake/o/n=(var_total) $("pkT_"+str_output) = NaNmake/o/n=(var_total) $("ar19_"+str_output) = NaNmake/o/n=(var_total) $("vol_"+str_output) = NaNmake/o/n=(var_total) $("ostB_"+str_output) = NaNmake/o/n=(var_total) $("ostR_"+str_output) = NaNmake/o/n=(var_total) $("lagB_"+str_output) = NaNmake/o/n=(var_total) $("lagR_"+str_output) = NaNmake/o/n=(var_total) $("rs19_"+str_output) = NaNmake/o/n=(var_total) $("rs28_"+str_output) = NaNdosilent 1	str_waves = stringfromlist(var_index,str_list_sort)	if (strlen(str_waves) == 0)		break	endif	if (var_index == 0)		variable/g var_fail = 0				wavestats/q/r=(var_bs-0.5*var_base_w,var_bs+0.5*var_base_w) $str_waves		variable/g var_baseY = v_avg		$("bs_"+str_output)[var_index] = v_avg		setdimlabel 0,var_index,$str_waves,$("bs_"+str_output)		w_base[var_index][0] = $str_waves(var_bs-0.5*var_base_w)		w_base[var_index][1] = $str_waves(var_bs+0.5*var_base_w)		w_base[var_index][2] = var_bs-0.5*var_base_w		w_base[var_index][3] = var_bs+0.5*var_base_w		setdimlabel 0,var_index,$str_waves,w_base		setdimlabel 1,0,base_y1,w_base		setdimlabel 1,1,base_y2,w_base		setdimlabel 1,2,base_x1,w_base		setdimlabel 1,3,base_x2,w_base				duplicate/o $str_waves tempDwave		differentiate tempDwave		smooth 10, tempDwave		wavestats/q/r=(var_bs,var_end) tempDwave		variable/g var_min_d = v_minloc		//wavestats/q/r=(var_stim,var_min_d) $str_waves		//variable/g var_max1_t = v_maxloc		duplicate/o $str_waves smthwave		smooth 10, smthwave		findpeak/q/r=(var_min_d,var_bs) smthwave		variable/g var_max1_t = v_peakloc		wavestats/q/r=(var_max1_t-0.5*var_peak_w,var_max1_t+0.5*var_peak_w) $str_waves		variable/g var_max1 = v_avg		//wavestats/q/r=(var_min_d,var_end) $str_waves		//variable/g var_max2_t = v_maxloc		findpeak/q/r=(var_min_d,var_end) smthwave		variable/g var_max2_t = v_peakloc		wavestats/q/r=(var_max2_t-0.5*var_peak_w,var_max2_t+0.5*var_peak_w) $str_waves		variable/g var_max2 = v_avg			wavestats/q/r=(var_max1_t,var_max2_t) $str_waves		variable/g var_min_t = v_minloc		wavestats/q/r=(var_min_t-0.5*var_peak_w,var_min_t+0.5*var_peak_w) $str_waves		variable/g var_min = v_avg			$("amp_"+str_output)[var_index] = var_max1 - var_min		setdimlabel 0,var_index,$str_waves,$("amp_"+str_output)		$("pkT_"+str_output)[var_index] = var_min_t-var_stim		$("vol_"+str_output)[var_index] = var_max1 - $("bs_"+str_output)[var_index]		setdimlabel 0,var_index,$str_waves,$("pkT_"+str_output)		w_peak1[var_index][0] = $str_waves(var_max1_t-0.5*var_peak_w)		w_peak1[var_index][1] = $str_waves(var_max1_t+0.5*var_peak_w)		w_peak1[var_index][2] = var_max1_t-0.5*var_peak_w		w_peak1[var_index][3] = var_max1_t+0.5*var_peak_w		setdimlabel 0,var_index,$str_waves,w_peak1		setdimlabel 1,0,peak1_y1,w_peak1		setdimlabel 1,1,peak1_y2,w_peak1		setdimlabel 1,2,peak1_x1,w_peak1		setdimlabel 1,3,peak1_x2,w_peak1		w_peak2[var_index][0] = $str_waves(var_min_t-0.5*var_peak_w)		w_peak2[var_index][1] = $str_waves(var_min_t+0.5*var_peak_w)		w_peak2[var_index][2] = var_min_t-0.5*var_peak_w		w_peak2[var_index][3] = var_min_t+0.5*var_peak_w		setdimlabel 0,var_index,$str_waves,w_peak2		setdimlabel 1,0,peak2_y1,w_peak2		setdimlabel 1,1,peak2_y2,w_peak2		setdimlabel 1,2,peak2_x1,w_peak2		setdimlabel 1,3,peak2_x2,w_peak2		w_peak3[var_index][0] = $str_waves(var_max2_t-0.5*var_peak_w)		w_peak3[var_index][1] = $str_waves(var_max2_t+0.5*var_peak_w)		w_peak3[var_index][2] = var_max2_t-0.5*var_peak_w		w_peak3[var_index][3] = var_max2_t+0.5*var_peak_w		setdimlabel 0,var_index,$str_waves,w_peak3		setdimlabel 1,0,peak3_y1,w_peak3		setdimlabel 1,1,peak3_y2,w_peak3		setdimlabel 1,2,peak3_x1,w_peak3		setdimlabel 1,3,peak3_x2,w_peak3				duplicate/o $str_waves, tempwave		tempwave = 0-(tempwave-max(var_max1,var_max2))		$("ar19_"+str_output)[var_index] = faverage(tempwave,var_max1_t,var_max2_t)		killwaves tempwave				if (round(var_max1_t - var_bs)<1)		var_max1_t = var_max1_t+1		variable/g var_fail = 1		endif		edgestats/q/r=(var_bs,var_max1_t) $str_waves		if (V_flag == 2)		variable/g var_fail = 1		$("rs19_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("rs19_"+str_output)		$("ostR_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("ostR_"+str_output)		$("lagR_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("lagR_"+str_output)		w_rise_1090[var_index][0] = NaN		w_rise_1090[var_index][1] = NaN		w_rise_1090[var_index][2] = NaN		w_rise_1090[var_index][3] = NaN		setdimlabel 0,var_index,$str_waves,w_rise_1090		setdimlabel 1,0,rise10_y,w_rise_1090		setdimlabel 1,1,rise90_y,w_rise_1090		setdimlabel 1,2,rise10_x,w_rise_1090		setdimlabel 1,3,rise90_x,w_rise_1090		else		variable/g var_r10 = v_edgeloc1		$("rs19_"+str_output)[var_index] = v_edgeloc3-v_edgeloc1		setdimlabel 0,var_index,$str_waves,$("rs19_"+str_output)		$("ostR_"+str_output)[var_index] = v_edgeloc1		setdimlabel 0,var_index,$str_waves,$("ostR_"+str_output)		$("lagR_"+str_output)[var_index] = v_edgeloc1-var_stim		setdimlabel 0,var_index,$str_waves,$("lagR_"+str_output)		w_rise_1090[var_index][0] = v_edgelvl1		w_rise_1090[var_index][1] = v_edgelvl3		w_rise_1090[var_index][2] = v_edgeloc1		w_rise_1090[var_index][3] = v_edgeloc3		setdimlabel 0,var_index,$str_waves,w_rise_1090		setdimlabel 1,0,rise10_y,w_rise_1090		setdimlabel 1,1,rise90_y,w_rise_1090		setdimlabel 1,2,rise10_x,w_rise_1090		setdimlabel 1,3,rise90_x,w_rise_1090		endif		edgestats/f=0.2/q/r=(var_bs,var_max1_t) $str_waves		if (V_flag == 2)		variable/g var_fail = 1		$("rs28_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("rs28_"+str_output)		w_rise_2080[var_index][0] = NaN		w_rise_2080[var_index][1] = NaN		w_rise_2080[var_index][2] = NaN		w_rise_2080[var_index][3] = NaN		setdimlabel 0,var_index,$str_waves,w_rise_2080		setdimlabel 1,0,rise20_y,w_rise_2080		setdimlabel 1,1,rise80_y,w_rise_2080		setdimlabel 1,2,rise20_x,w_rise_2080		setdimlabel 1,3,rise80_x,w_rise_2080		else		//variable/g var_fail = 0		$("rs28_"+str_output)[var_index] = v_edgeloc3-v_edgeloc1		setdimlabel 0,var_index,$str_waves,$("rs28_"+str_output)		w_rise_2080[var_index][0] = v_edgelvl1		w_rise_2080[var_index][1] = v_edgelvl3		w_rise_2080[var_index][2] = v_edgeloc1		w_rise_2080[var_index][3] = v_edgeloc3		setdimlabel 0,var_index,$str_waves,w_rise_2080		setdimlabel 1,0,rise20_y,w_rise_2080		setdimlabel 1,1,rise80_y,w_rise_2080		setdimlabel 1,2,rise20_x,w_rise_2080		setdimlabel 1,3,rise80_x,w_rise_2080		endif		findlevel/q/r=(var_max1_t,var_bs) $str_waves,$("bs_"+str_output)[var_index]		$("ostB_"+str_output)[var_index] = v_levelx		variable/g var_ost_ck = v_levelx		setdimlabel 0,var_index,$str_waves,$("ostB_"+str_output)		$("lagB_"+str_output)[var_index] = v_levelx-var_stim		setdimlabel 0,var_index,$str_waves,$("lagB_"+str_output)		w_onset[var_index][0] = $str_waves(v_levelx)		w_onset[var_index][1] = v_levelx		setdimlabel 0,var_index,$str_waves,w_onset		setdimlabel 1,0,onset_y,w_onset		setdimlabel 1,1,onset_x,w_onset				if(var_max1_t < var_bs || var_max1_t > var_end)			var_fail = 1			w_peak1[var_index][0] = NaN			w_peak1[var_index][1] = NaN			w_peak1[var_index][2] = NaN			w_peak1[var_index][3] = NaN		endif		if(var_min_t < var_bs || var_min_t > var_end)			$("amp_"+str_output)[var_index] = NaN			$("pkT_"+str_output)[var_index] = NaN			w_peak2[var_index][0] = NaN			w_peak2[var_index][1] = NaN			w_peak2[var_index][2] = NaN			w_peak2[var_index][3] = NaN		endif		if(var_max2_t < var_bs || var_max2_t > var_end)			$("amp_"+str_output)[var_index] = NaN			$("pkT_"+str_output)[var_index] = NaN			w_peak3[var_index][0] = NaN			w_peak3[var_index][1] = NaN			w_peak3[var_index][2] = NaN			w_peak3[var_index][3] = NaN		endif		if(var_ost_ck < var_bs || var_ost_ck > var_end)			var_fail = 1			w_onset[var_index][0] = NaN			w_onset[var_index][1] = NaN		endif		//if(var_max2_t < var_bs || var_max2_t > var_end)		//	if(var_min_t < var_bs || var_min_t > var_end)		//		if(var_max1_t < var_bs || var_max1_t > var_end)		//			var_fail = 1		//		endif		//	endif		//endif		//if(var_min_t < var_bs || var_min_t > var_end)		//	var_fail = 1		//endif				if (var_fail == 1)		$("bs_"+str_output)[var_index] = NaN		$("amp_"+str_output)[var_index] = NaN		$("pkT_"+str_output)[var_index] = NaN		$("ostB_"+str_output)[var_index] = NaN		$("ostR_"+str_output)[var_index] = NaN		$("lagB_"+str_output)[var_index] = NaN		$("lagR_"+str_output)[var_index] = NaN		$("rs19_"+str_output)[var_index] = NaN		$("rs28_"+str_output)[var_index] = NaN		$("ar19_"+str_output)[var_index] = NaN		$("vol_"+str_output)[var_index] = NaN		endif			else		variable/g var_fail = 0				wavestats/q/r=(var_bs-0.5*var_base_w,var_bs+0.5*var_base_w) $str_waves		variable/g var_baseY = v_avg		$("bs_"+str_output)[var_index] = v_avg		setdimlabel 0,var_index,$str_waves,$("bs_"+str_output)		w_base[var_index][0] = $str_waves(var_bs-0.5*var_base_w)		w_base[var_index][1] = $str_waves(var_bs+0.5*var_base_w)		w_base[var_index][2] = var_bs-0.5*var_base_w		w_base[var_index][3] = var_bs+0.5*var_base_w		setdimlabel 0,var_index,$str_waves,w_base		setdimlabel 1,0,base_y1,w_base		setdimlabel 1,1,base_y2,w_base		setdimlabel 1,2,base_x1,w_base		setdimlabel 1,3,base_x2,w_base				duplicate/o $str_waves tempDwave		differentiate tempDwave		smooth 10, tempDwave		wavestats/q/r=(var_bs,var_end) tempDwave		variable/g var_min_d = v_minloc		//wavestats/q/r=(var_stim,var_min_d) $str_waves		//variable/g var_max1_t = v_maxloc		duplicate/o $str_waves smthwave		smooth 10, smthwave		findpeak/q/r=(var_min_d,var_bs) smthwave		variable/g var_max1_t = v_peakloc		wavestats/q/r=(var_max1_t-0.5*var_peak_w,var_max1_t+0.5*var_peak_w) $str_waves		variable/g var_max1 = v_avg		//wavestats/q/r=(var_min_d,var_end) $str_waves		//variable/g var_max2_t = v_maxloc		findpeak/q/r=(var_min_d,var_end) smthwave		variable/g var_max2_t = v_peakloc		wavestats/q/r=(var_max2_t-0.5*var_peak_w,var_max2_t+0.5*var_peak_w) $str_waves		variable/g var_max2 = v_avg			wavestats/q/r=(var_max1_t,var_max2_t) $str_waves		variable/g var_min_t = v_minloc		wavestats/q/r=(var_min_t-0.5*var_peak_w,var_min_t+0.5*var_peak_w) $str_waves		variable/g var_min = v_avg			$("amp_"+str_output)[var_index] = var_max1 - var_min		setdimlabel 0,var_index,$str_waves,$("amp_"+str_output)		$("pkT_"+str_output)[var_index] = var_min_t-var_stim		$("vol_"+str_output)[var_index] = var_max1 - $("bs_"+str_output)[var_index]		setdimlabel 0,var_index,$str_waves,$("pkT_"+str_output)		w_peak1[var_index][0] = $str_waves(var_max1_t-0.5*var_peak_w)		w_peak1[var_index][1] = $str_waves(var_max1_t+0.5*var_peak_w)		w_peak1[var_index][2] = var_max1_t-0.5*var_peak_w		w_peak1[var_index][3] = var_max1_t+0.5*var_peak_w		setdimlabel 0,var_index,$str_waves,w_peak1		setdimlabel 1,0,peak1_y1,w_peak1		setdimlabel 1,1,peak1_y2,w_peak1		setdimlabel 1,2,peak1_x1,w_peak1		setdimlabel 1,3,peak1_x2,w_peak1		w_peak2[var_index][0] = $str_waves(var_min_t-0.5*var_peak_w)		w_peak2[var_index][1] = $str_waves(var_min_t+0.5*var_peak_w)		w_peak2[var_index][2] = var_min_t-0.5*var_peak_w		w_peak2[var_index][3] = var_min_t+0.5*var_peak_w		setdimlabel 0,var_index,$str_waves,w_peak2		setdimlabel 1,0,peak2_y1,w_peak2		setdimlabel 1,1,peak2_y2,w_peak2		setdimlabel 1,2,peak2_x1,w_peak2		setdimlabel 1,3,peak2_x2,w_peak2		w_peak3[var_index][0] = $str_waves(var_max2_t-0.5*var_peak_w)		w_peak3[var_index][1] = $str_waves(var_max2_t+0.5*var_peak_w)		w_peak3[var_index][2] = var_max2_t-0.5*var_peak_w		w_peak3[var_index][3] = var_max2_t+0.5*var_peak_w		setdimlabel 0,var_index,$str_waves,w_peak3		setdimlabel 1,0,peak3_y1,w_peak3		setdimlabel 1,1,peak3_y2,w_peak3		setdimlabel 1,2,peak3_x1,w_peak3		setdimlabel 1,3,peak3_x2,w_peak3				duplicate/o $str_waves, tempwave		tempwave = 0-(tempwave-max(var_max1,var_max2))		$("ar19_"+str_output)[var_index] = faverage(tempwave,var_max1_t,var_max2_t)		killwaves tempwave				if (round(var_max1_t - var_bs)<1)		var_max1_t = var_max1_t+1		variable/g var_fail = 1		endif		edgestats/q/r=(var_bs,var_max1_t) $str_waves		if (V_flag == 2)		variable/g var_fail = 1		$("rs19_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("rs19_"+str_output)		$("ostR_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("ostR_"+str_output)		$("lagR_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("lagR_"+str_output)		w_rise_1090[var_index][0] = NaN		w_rise_1090[var_index][1] = NaN		w_rise_1090[var_index][2] = NaN		w_rise_1090[var_index][3] = NaN		setdimlabel 0,var_index,$str_waves,w_rise_1090		setdimlabel 1,0,rise10_y,w_rise_1090		setdimlabel 1,1,rise90_y,w_rise_1090		setdimlabel 1,2,rise10_x,w_rise_1090		setdimlabel 1,3,rise90_x,w_rise_1090		else		variable/g var_r10 = v_edgeloc1		$("rs19_"+str_output)[var_index] = v_edgeloc3-v_edgeloc1		setdimlabel 0,var_index,$str_waves,$("rs19_"+str_output)		$("ostR_"+str_output)[var_index] = v_edgeloc1		setdimlabel 0,var_index,$str_waves,$("ostR_"+str_output)		$("lagR_"+str_output)[var_index] = v_edgeloc1-var_stim		setdimlabel 0,var_index,$str_waves,$("lagR_"+str_output)		w_rise_1090[var_index][0] = v_edgelvl1		w_rise_1090[var_index][1] = v_edgelvl3		w_rise_1090[var_index][2] = v_edgeloc1		w_rise_1090[var_index][3] = v_edgeloc3		setdimlabel 0,var_index,$str_waves,w_rise_1090		setdimlabel 1,0,rise10_y,w_rise_1090		setdimlabel 1,1,rise90_y,w_rise_1090		setdimlabel 1,2,rise10_x,w_rise_1090		setdimlabel 1,3,rise90_x,w_rise_1090		endif		edgestats/f=0.2/q/r=(var_bs,var_max1_t) $str_waves		if (V_flag == 2)		variable/g var_fail = 1		$("rs28_"+str_output)[var_index] = NaN		setdimlabel 0,var_index,$str_waves,$("rs28_"+str_output)		w_rise_2080[var_index][0] = NaN		w_rise_2080[var_index][1] = NaN		w_rise_2080[var_index][2] = NaN		w_rise_2080[var_index][3] = NaN		setdimlabel 0,var_index,$str_waves,w_rise_2080		setdimlabel 1,0,rise20_y,w_rise_2080		setdimlabel 1,1,rise80_y,w_rise_2080		setdimlabel 1,2,rise20_x,w_rise_2080		setdimlabel 1,3,rise80_x,w_rise_2080		else		//variable/g var_fail = 0		$("rs28_"+str_output)[var_index] = v_edgeloc3-v_edgeloc1		setdimlabel 0,var_index,$str_waves,$("rs28_"+str_output)		w_rise_2080[var_index][0] = v_edgelvl1		w_rise_2080[var_index][1] = v_edgelvl3		w_rise_2080[var_index][2] = v_edgeloc1		w_rise_2080[var_index][3] = v_edgeloc3		setdimlabel 0,var_index,$str_waves,w_rise_2080		setdimlabel 1,0,rise20_y,w_rise_2080		setdimlabel 1,1,rise80_y,w_rise_2080		setdimlabel 1,2,rise20_x,w_rise_2080		setdimlabel 1,3,rise80_x,w_rise_2080		endif		findlevel/q/r=(var_max1_t,var_bs) $str_waves,$("bs_"+str_output)[var_index]		$("ostB_"+str_output)[var_index] = v_levelx		variable/g var_ost_ck = v_levelx		setdimlabel 0,var_index,$str_waves,$("ostB_"+str_output)		$("lagB_"+str_output)[var_index] = v_levelx-var_stim		setdimlabel 0,var_index,$str_waves,$("lagB_"+str_output)		w_onset[var_index][0] = $str_waves(v_levelx)		w_onset[var_index][1] = v_levelx		setdimlabel 0,var_index,$str_waves,w_onset		setdimlabel 1,0,onset_y,w_onset		setdimlabel 1,1,onset_x,w_onset				if(var_max1_t < var_bs || var_max1_t > var_end)			var_fail = 1			w_peak1[var_index][0] = NaN			w_peak1[var_index][1] = NaN			w_peak1[var_index][2] = NaN			w_peak1[var_index][3] = NaN		endif		if(var_min_t < var_bs || var_min_t > var_end)			$("amp_"+str_output)[var_index] = NaN			$("pkT_"+str_output)[var_index] = NaN			w_peak2[var_index][0] = NaN			w_peak2[var_index][1] = NaN			w_peak2[var_index][2] = NaN			w_peak2[var_index][3] = NaN		endif		if(var_max2_t < var_bs || var_max2_t > var_end)			$("amp_"+str_output)[var_index] = NaN			$("pkT_"+str_output)[var_index] = NaN			w_peak3[var_index][0] = NaN			w_peak3[var_index][1] = NaN			w_peak3[var_index][2] = NaN			w_peak3[var_index][3] = NaN		endif		if(var_ost_ck < var_bs || var_ost_ck > var_end)			var_fail = 1			w_onset[var_index][0] = NaN			w_onset[var_index][1] = NaN		endif		//if(var_max2_t < var_bs || var_max2_t > var_end)		//	if(var_min_t < var_bs || var_min_t > var_end)		//		if(var_max1_t < var_bs || var_max1_t > var_end)		//			var_fail = 1		//		endif		//	endif		//endif		//if(var_min_t < var_bs || var_min_t > var_end)		//	var_fail = 1		//endif				if (var_fail == 1)		$("bs_"+str_output)[var_index] = NaN		$("amp_"+str_output)[var_index] = NaN		$("pkT_"+str_output)[var_index] = NaN		$("ostB_"+str_output)[var_index] = NaN		$("ostR_"+str_output)[var_index] = NaN		$("lagB_"+str_output)[var_index] = NaN		$("lagR_"+str_output)[var_index] = NaN		$("rs19_"+str_output)[var_index] = NaN		$("rs28_"+str_output)[var_index] = NaN		$("ar19_"+str_output)[var_index] = NaN		$("vol_"+str_output)[var_index] = NaN		endif	endif	var_index += 1while(1)//killwaves tempwaveappendtograph w_base[][0] vs w_base[][2]appendtograph w_base[][1] vs w_base[][3]appendtograph w_peak1[][0] vs w_peak1[][2]appendtograph w_peak1[][1] vs w_peak1[][3]appendtograph w_peak2[][0] vs w_peak2[][2]appendtograph w_peak2[][1] vs w_peak2[][3]appendtograph w_peak3[][0] vs w_peak3[][2]appendtograph w_peak3[][1] vs w_peak3[][3]appendtograph w_rise_1090[][0] vs w_rise_1090[][2]appendtograph w_rise_1090[][1] vs w_rise_1090[][3]appendtograph w_rise_2080[][0] vs w_rise_2080[][2]appendtograph w_rise_2080[][1] vs w_rise_2080[][3]appendtograph w_onset[][0] vs w_onset[][1]ModifyGraph mode(w_base)=3,mrkThick(w_base)=2,mode(w_base#1)=3,mrkThick(w_base#1)=2,mode(w_peak1)=3,mrkThick(w_peak1)=2,mode(w_peak1#1)=3,mrkThick(w_peak1#1)=2,mode(w_peak2)=3,mrkThick(w_peak2)=2,mode(w_peak2#1)=3,mrkThick(w_peak2#1)=2,mode(w_peak3)=3,mrkThick(w_peak3)=2,mode(w_peak3#1)=3,mrkThick(w_peak3#1)=2,mode(w_rise_1090)=3,mrkThick(w_rise_1090)=2,mode(w_rise_1090#1)=3,mrkThick(w_rise_1090#1)=2,mode(w_rise_2080)=3,mrkThick(w_rise_2080)=2,mode(w_rise_2080#1)=3,mrkThick(w_rise_2080#1)=2,mode(w_onset)=3,mrkThick(w_onset)=2ModifyGraph rgb(w_base)=(52428,52425,1),rgb(w_base#1)=(52428,52425,1)ModifyGraph rgb(w_peak1)=(52428,34958,1),rgb(w_peak1#1)=(52428,34958,1)ModifyGraph rgb(w_peak2)=(65535,0,0),rgb(w_peak2#1)=(65535,0,0)ModifyGraph rgb(w_peak3)=(36873,14755,58982),rgb(w_peak3#1)=(36873,14755,58982)ModifyGraph rgb(w_rise_1090)=(2,39321,1),rgb(w_rise_1090#1)=(2,39321,1)ModifyGraph rgb(w_rise_2080)=(16385,28398,65535),rgb(w_rise_2080#1)=(16385,28398,65535)ModifyGraph rgb(w_onset)=(65535,0,52428)edit $("bs_"+str_output).ld, $("amp_"+str_output).d, $("pkT_"+str_output).d, $("ostB_"+str_output).d, $("ostR_"+str_output).d, $("lagB_"+str_output).d, $("lagR_"+str_output).d, $("rs19_"+str_output).d, $("rs28_"+str_output).d, $("ar19_"+str_output).d, $("vol_"+str_output).dresumeupdatemovewindow var_left_t,var_top_t,var_right_t,var_bottom_t//duplicate/o/r=[][0] w_base $("w_base_"+str_output)//duplicate/o/r=[][0] w_onset $("w_lag_"+str_output)//$("w_lag_"+str_output) = $("w_lag_"+str_output) - var_stim//duplicate/o/r=[][0] w_onset $("w_onset_"+str_output)//duplicate/o/r=[][0] w_rise_1090 $("w_rise1090_"+str_output)//$("w_rise1090_"+str_output) = w_rise_1090[][1] - w_rise_1090[][0]//duplicate/o/r=[][0] w_rise_2080 $("w_rise2080_"+str_output)//$("w_rise2080_"+str_output) = w_rise_2080[][1] - w_rise_2080[][0]//duplicate/o/r=[][0] w_decay_1090 $("w_decay1090_"+str_output)//$("w_decay1090_"+str_output) = w_decay_1090[][1] - w_decay_1090[][0]//duplicate/o/r=[][0] w_decay_2080 $("w_decay2080_"+str_output)//$("w_decay2080_"+str_output) = w_decay_2080[][1] - w_decay_2080[][0]end