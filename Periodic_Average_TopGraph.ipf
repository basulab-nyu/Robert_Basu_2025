#pragma rtGlobals=1Macro Periodic_Average_TopGraph()pPeriodic_Average_TopGraph()proc pPeriodic_Average_TopGraph(str_period)string str_periodprompt str_period "period ?"string str_list = sortlist(tracenamelist("",";",1),";",16)print "\rinput traces:\r"print replacestring(";",str_list,"\r")variable var_period = str2num(str_period)string str_graph_list = sortlist(winlist("*",";","WIN:1"),";",16)string str_table_list = sortlist(winlist("*",";","WIN:2"),";",16)variable var_graph_last = itemsinlist(str_graph_list)-1string str_graph_last = winname(0,1)variable var_table_last = itemsinlist(str_table_list)-1string str_table_last = winname(0,2)getwindow $str_graph_last, wsizevariable var_left_g = v_left + 5.25variable var_top_g = v_top + 22.5variable var_right_g = v_right + 5.25variable var_bottom_g = v_bottom + 22.5getwindow $str_table_last, wsizevariable var_left_t = v_left + 5.25variable var_top_t = v_top + 22.5variable var_right_t = v_right + 5.25variable var_bottom_t = v_bottom + 22.5getaxis/q leftvariable var_left_max = v_maxvariable var_left_min = v_mingetaxis/q bottomvariable var_bottom_max = v_maxvariable var_bottom_min = v_minvariable var_index = 0variable var_scrollstring str_list_groupstring str_list_plot = ""do	var_scroll = var_index	str_list_group = ""	do		str_list_group = addlistitem(stringfromlist(var_scroll,str_list),str_list_group)		var_scroll+=var_period	while(var_scroll<itemsinlist(str_list))	print "\raveraging...\r"	print replacestring(";",str_list_group,"\r")	fwaveaverage(str_list_group,"",0,0,stringfromlist(0,str_list_group)+"_avg","")	str_list_plot = addlistitem(stringfromlist(0,str_list_group)+"_avg",str_list_plot)	var_index+=1while(var_index<var_period)var_index = 0pauseupdatedisplaymovewindow var_left_g,var_top_g,var_right_g,var_bottom_gdo	appendtograph $stringfromlist(var_index,str_list_plot)	var_index+=1while(var_index<itemsinlist(str_list_plot))modifygraph rgb = (0,0,0)setaxis left var_left_min,var_left_maxsetaxis bottom var_bottom_min,var_bottom_maxresumeupdateend